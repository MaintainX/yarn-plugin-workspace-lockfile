/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-workspace-lockfile",
factory: function (require) {
"use strict";var plugin=(()=>{var F=Object.create;var P=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var O=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(s,n)=>(typeof require<"u"?require:s)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var h=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports),q=(e,s)=>{for(var n in s)P(e,n,{get:s[n],enumerable:!0})},B=(e,s,n,a)=>{if(s&&typeof s=="object"||typeof s=="function")for(let g of Q(s))!Y.call(e,g)&&g!==n&&P(e,g,{get:()=>s[g],enumerable:!(a=H(s,g))||a.enumerable});return e};var z=(e,s,n)=>(n=e!=null?F(K(e)):{},B(s||!e||!e.__esModule?P(n,"default",{value:e,enumerable:!0}):n,e)),X=e=>B(P({},"__esModule",{value:!0}),e);var M=h((re,x)=>{x.exports=[{name:"Agola CI",constant:"AGOLA",env:"AGOLA_GIT_REF",pr:"AGOLA_PULL_REQUEST_ID"},{name:"Appcircle",constant:"APPCIRCLE",env:"AC_APPCIRCLE",pr:{env:"AC_GIT_PR",ne:"false"}},{name:"AppVeyor",constant:"APPVEYOR",env:"APPVEYOR",pr:"APPVEYOR_PULL_REQUEST_NUMBER"},{name:"AWS CodeBuild",constant:"CODEBUILD",env:"CODEBUILD_BUILD_ARN",pr:{env:"CODEBUILD_WEBHOOK_EVENT",any:["PULL_REQUEST_CREATED","PULL_REQUEST_UPDATED","PULL_REQUEST_REOPENED"]}},{name:"Azure Pipelines",constant:"AZURE_PIPELINES",env:"TF_BUILD",pr:{BUILD_REASON:"PullRequest"}},{name:"Bamboo",constant:"BAMBOO",env:"bamboo_planKey"},{name:"Bitbucket Pipelines",constant:"BITBUCKET",env:"BITBUCKET_COMMIT",pr:"BITBUCKET_PR_ID"},{name:"Bitrise",constant:"BITRISE",env:"BITRISE_IO",pr:"BITRISE_PULL_REQUEST"},{name:"Buddy",constant:"BUDDY",env:"BUDDY_WORKSPACE_ID",pr:"BUDDY_EXECUTION_PULL_REQUEST_ID"},{name:"Buildkite",constant:"BUILDKITE",env:"BUILDKITE",pr:{env:"BUILDKITE_PULL_REQUEST",ne:"false"}},{name:"CircleCI",constant:"CIRCLE",env:"CIRCLECI",pr:"CIRCLE_PULL_REQUEST"},{name:"Cirrus CI",constant:"CIRRUS",env:"CIRRUS_CI",pr:"CIRRUS_PR"},{name:"Cloudflare Pages",constant:"CLOUDFLARE_PAGES",env:"CF_PAGES"},{name:"Codefresh",constant:"CODEFRESH",env:"CF_BUILD_ID",pr:{any:["CF_PULL_REQUEST_NUMBER","CF_PULL_REQUEST_ID"]}},{name:"Codemagic",constant:"CODEMAGIC",env:"CM_BUILD_ID",pr:"CM_PULL_REQUEST"},{name:"Codeship",constant:"CODESHIP",env:{CI_NAME:"codeship"}},{name:"Drone",constant:"DRONE",env:"DRONE",pr:{DRONE_BUILD_EVENT:"pull_request"}},{name:"dsari",constant:"DSARI",env:"DSARI"},{name:"Earthly",constant:"EARTHLY",env:"EARTHLY_CI"},{name:"Expo Application Services",constant:"EAS",env:"EAS_BUILD"},{name:"Gerrit",constant:"GERRIT",env:"GERRIT_PROJECT"},{name:"Gitea Actions",constant:"GITEA_ACTIONS",env:"GITEA_ACTIONS"},{name:"GitHub Actions",constant:"GITHUB_ACTIONS",env:"GITHUB_ACTIONS",pr:{GITHUB_EVENT_NAME:"pull_request"}},{name:"GitLab CI",constant:"GITLAB",env:"GITLAB_CI",pr:"CI_MERGE_REQUEST_ID"},{name:"GoCD",constant:"GOCD",env:"GO_PIPELINE_LABEL"},{name:"Google Cloud Build",constant:"GOOGLE_CLOUD_BUILD",env:"BUILDER_OUTPUT"},{name:"Harness CI",constant:"HARNESS",env:"HARNESS_BUILD_ID"},{name:"Heroku",constant:"HEROKU",env:{env:"NODE",includes:"/app/.heroku/node/bin/node"}},{name:"Hudson",constant:"HUDSON",env:"HUDSON_URL"},{name:"Jenkins",constant:"JENKINS",env:["JENKINS_URL","BUILD_ID"],pr:{any:["ghprbPullId","CHANGE_ID"]}},{name:"LayerCI",constant:"LAYERCI",env:"LAYERCI",pr:"LAYERCI_PULL_REQUEST"},{name:"Magnum CI",constant:"MAGNUM",env:"MAGNUM"},{name:"Netlify CI",constant:"NETLIFY",env:"NETLIFY",pr:{env:"PULL_REQUEST",ne:"false"}},{name:"Nevercode",constant:"NEVERCODE",env:"NEVERCODE",pr:{env:"NEVERCODE_PULL_REQUEST",ne:"false"}},{name:"Prow",constant:"PROW",env:"PROW_JOB_ID"},{name:"ReleaseHub",constant:"RELEASEHUB",env:"RELEASE_BUILD_ID"},{name:"Render",constant:"RENDER",env:"RENDER",pr:{IS_PULL_REQUEST:"true"}},{name:"Sail CI",constant:"SAIL",env:"SAILCI",pr:"SAIL_PULL_REQUEST_NUMBER"},{name:"Screwdriver",constant:"SCREWDRIVER",env:"SCREWDRIVER",pr:{env:"SD_PULL_REQUEST",ne:"false"}},{name:"Semaphore",constant:"SEMAPHORE",env:"SEMAPHORE",pr:"PULL_REQUEST_NUMBER"},{name:"Sourcehut",constant:"SOURCEHUT",env:{CI_NAME:"sourcehut"}},{name:"Strider CD",constant:"STRIDER",env:"STRIDER"},{name:"TaskCluster",constant:"TASKCLUSTER",env:["TASK_ID","RUN_ID"]},{name:"TeamCity",constant:"TEAMCITY",env:"TEAMCITY_VERSION"},{name:"Travis CI",constant:"TRAVIS",env:"TRAVIS",pr:{env:"TRAVIS_PULL_REQUEST",ne:"false"}},{name:"Vela",constant:"VELA",env:"VELA",pr:{VELA_PULL_REQUEST:"1"}},{name:"Vercel",constant:"VERCEL",env:{any:["NOW_BUILDER","VERCEL"]},pr:"VERCEL_GIT_PULL_REQUEST_ID"},{name:"Visual Studio App Center",constant:"APPCENTER",env:"APPCENTER_BUILD_ID"},{name:"Woodpecker",constant:"WOODPECKER",env:{CI:"woodpecker"},pr:{CI_BUILD_EVENT:"pull_request"}},{name:"Xcode Cloud",constant:"XCODE_CLOUD",env:"CI_XCODE_PROJECT",pr:"CI_PULL_REQUEST_NUMBER"},{name:"Xcode Server",constant:"XCODE_SERVER",env:"XCS"}]});var b=h(_=>{"use strict";var W=M(),E=process.env;Object.defineProperty(_,"_vendors",{value:W.map(function(e){return e.constant})});_.name=null;_.isPR=null;_.id=null;W.forEach(function(e){let n=(Array.isArray(e.env)?e.env:[e.env]).every(function(a){return $(a)});_[e.constant]=n,n&&(_.name=e.name,_.isPR=J(e),_.id=e.constant)});_.isCI=!!(E.CI!=="false"&&(E.BUILD_ID||E.BUILD_NUMBER||E.CI||E.CI_APP_ID||E.CI_BUILD_ID||E.CI_BUILD_NUMBER||E.CI_NAME||E.CONTINUOUS_INTEGRATION||E.RUN_ID||_.name));function $(e){return typeof e=="string"?!!E[e]:"env"in e?E[e.env]&&E[e.env].includes(e.includes):"any"in e?e.any.some(function(s){return!!E[s]}):Object.keys(e).every(function(s){return E[s]===e[s]})}function J(e){switch(typeof e.pr){case"string":return!!E[e.pr];case"object":return"env"in e.pr?"any"in e.pr?e.pr.any.some(function(s){return E[e.pr.env]===s}):e.pr.env in E&&E[e.pr.env]!==e.pr.ne:"any"in e.pr?e.pr.any.some(function(s){return!!E[s]}):$(e.pr);default:return null}}});var se={};q(se,{default:()=>ne});var t=O("@yarnpkg/core"),k=O("@yarnpkg/fslib"),V=z(b());async function Z(e,s,n,{report:a,immutable:g,cache:y,persistProject:A}){try{let m=new Set,U=s.manifest;for(let d of["dependencies","devDependencies","peerDependencies"]){let i=U.getForScope(d);n.configuration.get("enableVerboseLogging")&&a.reportInfo(t.MessageName.UNNAMED,`Found ${i.size} ${d}`);for(let r of i.values()){let I=n.workspaces.find(u=>u.manifest.raw.name===r.name||u.manifest.raw.name===`@${r.scope}/${r.name}`);if(I){let u=t.structUtils.makeDescriptor(t.structUtils.makeIdent(r.scope||"",r.name),r.range);m.add(u),n.configuration.get("enableVerboseLogging")&&a.reportInfo(t.MessageName.UNNAMED,`Added workspace dependency: ${t.structUtils.stringifyDescriptor(u)}`);for(let f of["dependencies","devDependencies","peerDependencies"]){let p=I.manifest.getForScope(f);for(let l of p.values()){let c=t.structUtils.makeDescriptor(t.structUtils.makeIdent(l.scope||"npm",l.name),l.range);m.add(c),n.configuration.get("enableVerboseLogging")&&a.reportInfo(t.MessageName.UNNAMED,`Added transitive dependency from workspace: ${t.structUtils.stringifyDescriptor(c)}`)}}}else{let u=r.scope?`@${r.scope}/${r.name}`:r.name,f=t.structUtils.parseIdent(u),p=r.range.startsWith("workspace:")||r.range.startsWith("npm:")?r.range:`npm:${r.range}`,l=t.structUtils.makeDescriptor(f,p);m.add(l),n.configuration.get("enableVerboseLogging")&&a.reportInfo(t.MessageName.UNNAMED,`Added dependency: ${t.structUtils.stringifyDescriptor(l)}`)}}}let L=new Map,S=new Set,o=new Map,D=d=>{let i=t.structUtils.parseDescriptor(d);return i.range.startsWith("workspace:")?t.structUtils.stringifyDescriptor(i):t.structUtils.stringifyDescriptor(t.structUtils.makeDescriptor(i,`npm:${i.range.replace(/^npm:/,"")}`))},C=d=>{let i=t.structUtils.stringifyDescriptor(d),r=D(i);if(S.has(r))return;let I=n.storedResolutions.get(d.descriptorHash);if(!I){n.configuration.get("enableVerboseLogging")&&a.reportInfo(t.MessageName.UNNAMED,`No resolution found for ${i}`);return}o.has(I)||o.set(I,new Set),o.get(I).add(d);let u=n.storedPackages.get(I);if(!u){n.configuration.get("enableVerboseLogging")&&a.reportInfo(t.MessageName.UNNAMED,`No package found for ${i}`);return}S.add(r);for(let[f,p]of u.dependencies)C(p);for(let[f,p]of u.peerDependencies)C(p)};for(let d of m)C(d);for(let[d,i]of o){let r=n.storedPackages.get(d);if(!r)continue;let I=Array.from(i).map(l=>t.structUtils.stringifyDescriptor(l)).filter(l=>!l.includes("virtual:")).sort();if(I.length===0)continue;let u=I.join(", "),f=new Map,p=new Map;for(let[l,c]of r.dependencies){let R=c.range.startsWith("virtual:")?`npm:${c.range.replace(/^virtual:[^#]+#npm:/,"")}`:c.range.startsWith("workspace:")||c.range.startsWith("npm:")?c.range:`npm:${c.range}`;f.set(t.structUtils.stringifyIdent(c),R)}for(let[l,c]of r.peerDependencies){let R=t.structUtils.stringifyIdent(c),w=c.range.startsWith("virtual:")?`npm:${c.range.replace(/^virtual:[^#]+#npm:/,"")}`:c.range.startsWith("workspace:")||c.range.startsWith("npm:")?c.range:`npm:${c.range}`;if(R.startsWith("@types/")&&r.peerDependenciesMeta.get(R)?.optional&&c.range==="*"){n.configuration.get("enableVerboseLogging")&&a.reportInfo(t.MessageName.UNNAMED,`Skipping optional @types peer dependency: ${R}@${w}`);continue}p.set(R,w)}L.set(u,{version:r.linkType===t.LinkType.SOFT&&r.reference.startsWith("workspace:")?"0.0.0-use.local":r.version,resolution:t.structUtils.stringifyLocator(r),dependencies:f,peerDependencies:p,bin:r.bin,checksum:n.storedChecksums.get(d)||"",languageName:r.languageName,linkType:r.linkType})}n.configuration.get("enableVerboseLogging")&&a.reportInfo(t.MessageName.UNNAMED,`Generated ${L.size} entries for workspace lockfile`);let T=Array.from(L.entries()).sort().map(([d,i])=>{let r=i.dependencies.size>0?`  dependencies:
${Array.from(i.dependencies.entries()).sort().map(([f,p])=>{let l=p.startsWith("workspace:")?p:`npm:${p.replace(/^npm:/,"")}`;return`    ${f.startsWith("@")?`"${f}"`:f}: "${l}"`}).join(`
`)}`:"",I=i.peerDependencies.size>0?`  peerDependencies:
${Array.from(i.peerDependencies.entries()).sort().map(([f,p])=>{let l=p.startsWith("workspace:")?p:`${p.replace(/^npm:/,"")}`,c=l.match(/[:\{\}\[\]\,&*#?<>=!%@\\]/)?`"${l}"`:l;return`    ${f.startsWith("@")?`"${f}"`:f}: ${c}`}).join(`
`)}`:"";return[`"${d}":`,`  version: ${i.version||"unknown"}`,`  resolution: "${i.resolution}"`,r,I,i.bin.size>0?`  bin:
${Array.from(i.bin.entries()).map(([f,p])=>`    ${f}: ${p}`).join(`
`)}`:"",`  checksum: ${i.checksum}`,`  languageName: ${i.languageName.toLowerCase()}`,`  linkType: ${i.linkType.toLowerCase()}`].filter(Boolean).join(`
`)+`
`}).join(`
`),G=y.cacheKey,v=`# This file is generated by running "yarn install" inside your project through the workspace-lockfile plugin.
# Manual changes might be lost - proceed with caution!

__metadata:
  version: ${n.lockfileLastVersion??"6"}
  cacheKey: ${G}

${T}`,N=k.ppath.join(s.cwd,"yarn.workspace.lock");if(g){if(await k.xfs.readFilePromise(N,"utf-8")===v)return;a.reportError(t.MessageName.UNNAMED,`The lockfile ${N} would have been modified by this install, which is explicitly forbidden`)}else await k.xfs.writeFilePromise(N,v),a.reportInfo(t.MessageName.UNNAMED,`Created ${N}`)}catch(m){let U=m instanceof Error?m.message:String(m);a.reportError(t.MessageName.UNNAMED,`Failed to generate lockfile for ${e}: ${U}`)}}function j(e,s){if(s.persistProject!==!1)return{isWorkspaceFocused:!1};let n=process.argv.slice(2),a=n[0]==="workspaces"&&n[1]==="focus",g=a&&n.some(o=>o==="--production"),y=a&&n.some(o=>o==="--all"||o==="-A");if(!a)return{isWorkspaceFocused:!1};if(y)return{isWorkspaceFocused:!0,isProduction:g,workspaces:e.workspaces};let A=n.slice(2).filter(o=>!o.startsWith("-"));if(A.length===0){let o=k.ppath.cwd(),D=e.workspacesByCwd.get(o);if(!D)throw new Error(`No workspace found in ${o}, please specify a workspace or use --all or -A`);A.push(D.manifest.raw.name)}let m=new Map(e.workspaces.map(o=>[o.manifest.raw.name,o])),U=new Set(A),L=new Set;function S(o){if(!L.has(o)){L.add(o),U.add(o.manifest.raw.name);for(let[D,C]of new Map([...o.manifest.getForScope("dependencies").entries(),...o.manifest.getForScope("devDependencies").entries()]))if(C.range.startsWith("workspace:")){let T=m.get(C.name);T&&S(T)}}}for(let o of U){let D=m.get(o);if(D)S(D);else throw new Error(`Workspace ${o} not found in the project`)}return{isWorkspaceFocused:a,isProduction:g,workspaces:Array.from(L)}}var ee={configuration:{enableVerboseLogging:{description:"If true, enables verbose logging for workspace lockfile generation",type:t.SettingsType.BOOLEAN,default:!1}},hooks:{async afterAllInstalled(e,s){let n=j(e,s);n.isWorkspaceFocused&&(n.isProduction||!n.workspaces?.length)||(n.isWorkspaceFocused&&V.isCI&&(s.immutable=!0),await s.report.startTimerPromise("Workspace lockfiles step",async()=>{for(let a of n.workspaces??e.workspaces){let g=a.manifest.raw.name||a.cwd;await s.report.startTimerPromise(`Generating lockfile for ${g}`,async()=>{await Z(g,a,e,s)})}}))}}},ne=ee;return X(se);})();
return plugin;
}
};
